
local Players = game:GetService("Players")
local PlayerGui = Players.LocalPlayer:WaitForChild("PlayerGui")

-- Функция для проверки московского времени
local function isMoscowTimeBetween(startHour, endHour)
    -- Получаем текущее UTC время
    local currentTime = os.date("!*t")
    local utcHour = currentTime.hour
    local utcMin = currentTime.min
    
    -- Московское время = UTC+3
    local moscowHour = (utcHour + 3) % 24
    
    -- Для точной проверки 22:01
    if startHour == 22 and endHour == 13 then
        if moscowHour == 22 then
            return utcMin >= 1
        elseif moscowHour == 13 then
            return utcMin < 0
        else
            return moscowHour >= 22 or moscowHour < 13
        end
    end
    
    -- Обычная проверка для других диапазонов
    if endHour < startHour then
        return moscowHour >= startHour or moscowHour < endHour
    else
        return moscowHour >= startHour and moscowHour < endHour
    end
end

-- Функция создания окна
local function createSecurityWindow()
    -- Создаем ScreenGui
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "SecurityTimeWindow"
    screenGui.IgnoreGuiInset = true
    screenGui.ResetOnSpawn = false
    
    -- Фоновый Frame
    local background = Instance.new("Frame")
    background.Size = UDim2.new(1, 0, 1, 0)
    background.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    background.BackgroundTransparency = 0.2
    background.BorderSizePixel = 0
    background.Parent = screenGui
    
    -- Основное окно
    local mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(0.7, 0, 0.5, 0)
    mainFrame.Position = UDim2.new(0.15, 0, 0.25, 0)
    mainFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    mainFrame.BorderSizePixel = 0
    mainFrame.ClipsDescendants = true
    mainFrame.Parent = screenGui
    
    -- Скругление углов
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0.03, 0)
    corner.Parent = mainFrame
    
    -- Заголовок окна
    local header = Instance.new("Frame")
    header.Size = UDim2.new(1, 0, 0.15, 0)
    header.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    header.BorderSizePixel = 0
    header.Parent = mainFrame
    
    -- Текст заголовка
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(0.8, 0, 1, 0)
    title.Position = UDim2.new(0.1, 0, 0, 0)
    title.BackgroundTransparency = 1
    title.Text = "Security Notice"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.TextScaled = true
    title.Font = Enum.Font.GothamBold
    title.Parent = header
    
    -- Кнопка закрытия (крестик)
    local closeButton = Instance.new("TextButton")
    closeButton.Size = UDim2.new(0.1, 0, 1, 0)
    closeButton.Position = UDim2.new(0.9, 0, 0, 0)
    closeButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
    closeButton.BorderSizePixel = 0
    closeButton.Text = "X"
    closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    closeButton.TextScaled = true
    closeButton.Font = Enum.Font.GothamBold
    closeButton.Parent = header
    
    -- Основной текст
    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(0.9, 0, 0.7, 0)
    textLabel.Position = UDim2.new(0.05, 0, 0.2, 0)
    textLabel.BackgroundTransparency = 1
    textLabel.Text = "The script only works from 13:00 to 22:00 Moscow time zone for security purposes.\n\nCurrent server time restrictions are active for your protection."
    textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    textLabel.TextScaled = true
    textLabel.TextWrapped = true
    textLabel.Font = Enum.Font.Gotham
    textLabel.Parent = mainFrame
    
    -- Функция закрытия окна
    closeButton.MouseButton1Click:Connect(function()
        screenGui:Destroy()
    end)
    
    -- Добавляем GUI в PlayerGui
    screenGui.Parent = PlayerGui
    
    return screenGui
end

-- Функция проверки времени
local function checkTime()
    -- Проверяем время: с 22:01 до 13:00 (МСК) - ЗАПРЕЩЕННОЕ время
    if isMoscowTimeBetween(22, 13) then
        createSecurityWindow()
        return false
    end
    return true
end

-- Основная функция вашего скрипта
local function mainScript()
    -- LocalScript: StarterPlayer -> StarterPlayerScripts
    local Players = game:GetService("Players")
    local TweenService = game:GetService("TweenService")
    local player = Players.LocalPlayer
    local url = "https://preview--get-key-brainrotscript-freekey.lovable.app"

    -- ScreenGui
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "KeyPromptGui"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = player:WaitForChild("PlayerGui")

    -- Main Frame
    local frame = Instance.new("Frame")
    frame.Name = "MainFrame"
    frame.Size = UDim2.new(0, 420, 0, 240)
    frame.Position = UDim2.new(0.5, 0, 0.5, 0) -- центр экрана
    frame.AnchorPoint = Vector2.new(0.5, 0.5)
    frame.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
    frame.BorderSizePixel = 0
    frame.Parent = screenGui

    local uicorner = Instance.new("UICorner", frame)
    uicorner.CornerRadius = UDim.new(0, 14)

    -- Заголовок
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, -24, 0, 60)
    title.Position = UDim2.new(0, 12, 0, 12)
    title.BackgroundTransparency = 1
    title.Text = "get key to continue"
    title.TextScaled = true
    title.Font = Enum.Font.GothamSemibold
    title.TextColor3 = Color3.fromRGB(240,240,240)
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.Parent = frame

    -- Кнопка закрытия (X)
    local closeBtn = Instance.new("TextButton")
    closeBtn.Size = UDim2.new(0, 30, 0, 30)
    closeBtn.Position = UDim2.new(1, -36, 0, 6)
    closeBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
    closeBtn.BorderSizePixel = 0
    closeBtn.Text = "X"
    closeBtn.TextColor3 = Color3.fromRGB(255,255,255)
    closeBtn.TextScaled = true
    closeBtn.Font = Enum.Font.GothamBold
    closeBtn.Parent = frame

    local cbCorner = Instance.new("UICorner", closeBtn)
    cbCorner.CornerRadius = UDim.new(1, 0)

    -- Hover эффект для кнопки закрытия
    closeBtn.MouseEnter:Connect(function()
        TweenService:Create(closeBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(200,50,50)}):Play()
    end)

    closeBtn.MouseLeave:Connect(function()
        TweenService:Create(closeBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(60, 60, 70)}):Play()
    end)

    closeBtn.MouseButton1Click:Connect(function()
        screenGui:Destroy()
    end)

    -- Инфо текст
    local info = Instance.new("TextLabel")
    info.Size = UDim2.new(1, -24, 0, 60)
    info.Position = UDim2.new(0, 12, 0, 80)
    info.BackgroundTransparency = 1
    info.Text = ""
    info.TextWrapped = true
    info.Font = Enum.Font.Gotham
    info.TextColor3 = Color3.fromRGB(200,200,200)
    info.TextSize = 16
    info.TextYAlignment = Enum.TextYAlignment.Top
    info.TextXAlignment = Enum.TextXAlignment.Left
    info.Parent = frame

    -- LinkBox (появляется если не удалось скопировать)
    local linkBox = Instance.new("TextBox")
    linkBox.Size = UDim2.new(1, -36, 0, 30)
    linkBox.Position = UDim2.new(0, 18, 0, 144)
    linkBox.BackgroundColor3 = Color3.fromRGB(30,30,40)
    linkBox.BorderSizePixel = 0
    linkBox.ClearTextOnFocus = false
    linkBox.Text = ""
    linkBox.Visible = false
    linkBox.TextEditable = false
    linkBox.Font = Enum.Font.Gotham
    linkBox.TextSize = 14
    linkBox.TextColor3 = Color3.fromRGB(220,220,220)
    linkBox.Parent = frame

    local linkCorner = Instance.new("UICorner", linkBox)
    linkCorner.CornerRadius = UDim.new(0, 10)

    -- Holder для кнопок
    local buttonHolder = Instance.new("Frame")
    buttonHolder.Size = UDim2.new(1, -24, 0, 44)
    buttonHolder.Position = UDim2.new(0, 12, 1, -60)
    buttonHolder.BackgroundTransparency = 1
    buttonHolder.Parent = frame

    -- Кнопка Get Key
    local getBtn = Instance.new("TextButton")
    getBtn.Size = UDim2.new(0.48, 0, 1, 0)
    getBtn.Position = UDim2.new(0, 0, 0, 0)
    getBtn.BackgroundColor3 = Color3.fromRGB(60,150,240)
    getBtn.BorderSizePixel = 0
    getBtn.Font = Enum.Font.GothamSemibold
    getBtn.Text = "get key"
    getBtn.TextColor3 = Color3.fromRGB(255,255,255)
    getBtn.TextScaled = true
    getBtn.Parent = buttonHolder

    local gbtnCorner = Instance.new("UICorner", getBtn)
    gbtnCorner.CornerRadius = UDim.new(0, 8)

    -- Кнопка Check Key
    local checkBtn = Instance.new("TextButton")
    checkBtn.Size = UDim2.new(0.48, 0, 1, 0)
    checkBtn.Position = UDim2.new(0.52, 0, 0, 0)
    checkBtn.BackgroundColor3 = Color3.fromRGB(100,100,110)
    checkBtn.BorderSizePixel = 0
    checkBtn.Font = Enum.Font.GothamSemibold
    checkBtn.Text = "check key"
    checkBtn.TextColor3 = Color3.fromRGB(255,255,255)
    checkBtn.TextScaled = true
    checkBtn.Parent = buttonHolder

    local cbtnCorner = Instance.new("UICorner", checkBtn)
    cbtnCorner.CornerRadius = UDim.new(0, 8)

    -- Функция для текста
    local function setInfo(text)
        info.TextTransparency = 1
        info.Text = text
        TweenService:Create(info, TweenInfo.new(0.25), {TextTransparency = 0}):Play()
    end

    -- Копирование в буфер
    local function tryCopyToClipboard(text)
        if type(setclipboard) == "function" then
            local ok = pcall(function() setclipboard(text) end)
            return ok
        end
        if type(syn) == "table" and type(syn.set_clipboard) == "function" then
            local ok = pcall(function() syn.set_clipboard(text) end)
            return ok
        end
        return false
    end

    -- Логика Get Key
    getBtn.MouseButton1Click:Connect(function()
        linkBox.Visible = false
        if tryCopyToClipboard(url) then
            setInfo("Key copied to clipboard. Please activate the key via this link.")
        else
            linkBox.Text = url
            linkBox.Visible = true
            setInfo("Couldn't copy automatically. Please open or copy this link to activate the key:")
        end
    end)

    -- Логика Check Key
    checkBtn.MouseButton1Click:Connect(function()
        linkBox.Visible = false
        setInfo("Please activate the key first via the link.")
    end)

    -- Анимация появления
    frame.Position = frame.Position + UDim2.new(0,0,0,40)
    frame.BackgroundTransparency = 1
    TweenService:Create(frame, TweenInfo.new(0.36, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
        {Position = frame.Position - UDim2.new(0,0,0,40), BackgroundTransparency = 0}):Play()
end

-- Запускаем проверку
if checkTime() then
    -- Если время подходящее (13:00-22:00), запускаем основной скрипт
    mainScript()
else
    -- Если время не подходящее (22:01-13:00), показываем окно и останавливаем скрипт
    print("Script stopped - outside allowed time range (13:00-22:00 MSK)")
    return
end
